% KansasLava-AK.tex
\begin{hcarentry}[updated]{Kansas Lava}
\label{klava}
\report{Andy Gill}%11/11
\participants{Andy Gill, Bowe Neuenschwander}
\status{ongoing}
\makeheader

Kansas Lava is a Domain Specific Language (DSL) for expressing
hardware descriptions of computations, and is hosted inside the
language Haskell. Kansas Lava programs are descriptions of specific hardware
entities, the connections between them, and other computational abstractions
that can compile down to these entities. Large circuits have been successfully
expressed using Kansas Lava, and Haskell's powerful abstraction mechanisms, as
well as generic generative techniques, can be applied to good effect to provide
descriptions of highly efficient circuits.

Kansas Lava has undergone considerable changes over the last 12 months.
\begin{itemize}
\item The Patches idea (normalizing handshaking circuits) and the Wakarusa
Monad (compiling state machines into untyped Fabrics) have been rejected. There
was a PEPM'12 paper about Patches,
including the design and implementation of a controller for an ST7066U-powered
LCD display.
Wakarusa was never written up.

\item Patches and Wakarusa have been replaced with a unified enhancement of the Fabric
monad. The Fabric monad historically provides access to named input/output ports,
and now also provided named variables, implemented by ports that loop back on
themselves. This additional primitive capability allows for a {\em typed\/}
state machine monad.
This design gives an elegant stratospheric pattern: purely functional circuits using streams;
a monad for layout over {\em space\/}, and a monad for state generation,
that acts over {\em time\/}.

\item 
On top of Kansas Lava, we are developing Kansas Lava Cores.
In hardware, a core is a component
that can be realized as a circuit, typically on an FPGA. Kansas Lava Cores
contains about a dozen cores, and basic board support for Spartan3e,
as well as a high-fidelity emulator for the Spartan3e. The
cores and the simulator has been rewritten to use the new Fabric
and new state-machine generation monad.

\item Using various components provided as Kansas Lava Cores, 
we continue developing the $\lambda$-bridge 
with implementations (in Haskell and
Kansas Lava) of a simple protocol stack for communicating with FPGAs.
This bridge is based round the best-effort, unreliable,
but acknowledgment-based access to a 8-bit WISHBONE-compliant hardware bus,
and idempotent transaction requests.
This has the advantage of moving the implementation
of the complexity of providing reliable communications into the Haskell
code. The net effect is that programmers can use Haskell to
talk to real hardware over multiple possible physical connections
(RS232, RJ-45, USB, etc), and communicate via standard Haskell
idioms like file Handles, Chans, and MVars.

\item Finally, with Iavor Diatchki (Galois), we are reworking our {\tt sized-types\/}
library to use the new kind {\tt Nat} in GHC 7.6.
\end{itemize}

\FurtherReading
\begin{compactitem}
\item
  \url{http://www.ittc.ku.edu/csdl/fpg/Tools/KansasLava}\\
\item
  \url{http://www.youtube.com/playlist?list=PL211F8711E3B3DF9C}  
\end{compactitem}
\end{hcarentry}
